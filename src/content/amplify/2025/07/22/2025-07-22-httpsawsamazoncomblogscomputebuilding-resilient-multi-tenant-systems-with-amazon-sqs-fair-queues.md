---
author: Amazon Web Services
cover_image: >-
  https://d2908q01vomqb2.cloudfront.net/1b6453892473a467d07372d45eb05abc2031647a/2025/07/21/ComputeBlog-2297-featured-images-1-1120x630.png
date: '2025-07-22T11:16:28.023Z'
dateFolder: 2025/07/22
description: >-
  Today, AWS introduced Amazon Simple Queue Service (Amazon SQS) fair queues, a
  new feature that mitigates noisy neighbor impact in multi-tenant systems. With
  fair queues, your applications become more resilient and easier to operate,
  reducing operational overhead while improving quality of service for your
  customers. In distributed architectures, message queues have become the
  backbone of […]
isBasedOn: >-
  https://aws.amazon.com/blogs/compute/building-resilient-multi-tenant-systems-with-amazon-sqs-fair-queues/
link: >-
  https://aws.amazon.com/blogs/compute/building-resilient-multi-tenant-systems-with-amazon-sqs-fair-queues/
slug: >-
  2025-07-22-httpsawsamazoncomblogscomputebuilding-resilient-multi-tenant-systems-with-amazon-sqs-fair-queues
tags:
  - tech
title: Building resilient multi-tenant systems with Amazon SQS fair queues
---
<p>Today, AWS introduced <a href="https://aws.amazon.com/sqs/">Amazon Simple Queue Service (Amazon SQS)</a> fair queues, a new feature that mitigates <a href="https://docs.aws.amazon.com/wellarchitected/latest/saas-lens/noisy-neighbor.html">noisy neighbor</a> impact in multi-tenant systems. With fair queues, your applications become more resilient and easier to operate, reducing operational overhead while improving quality of service for your customers.</p>
<p>In distributed architectures, message queues have become the backbone of resilient system design. They act as buffers between components, allowing services to process work asynchronously and at their own pace. When a sudden traffic spike hits your application, queues prevent cascading failures by buffering work and ensuring that downstream services aren’t overwhelmed. Amazon SQS has long been a go-to solution for developers building scalable applications because it’s a fully managed serverless solution that can seamlessly scale to ingest millions of messages per second.</p>
<p>In this post, you learn how to use Amazon SQS fair queues and understand their inner workings through a practical example.</p>
<h2>Overview</h2>
<p>Many modern applications follow a multi-tenant architecture, where a single application instance serves multiple tenants. A tenant is any entity that shares resources with others. It could be a customer, client application, or request type. This approach reduces operational costs and simplifies maintenance through efficient resource utilization. One example of such shared resources are queues and their associated consumer capacity.</p>
<p>However, multi-tenant systems face challenges when one tenant becomes a noisy neighbor. This tenant impacts others by overutilizing your system’s resources. With queues, this tenant causes a backlog by sending a large volume of messages or by requiring longer processing time. Regular queues deliver older messages first, which increases message dwell time for all tenants in such scenarios. This makes it difficult to maintain quality of service and forces teams to over-provision resources or build complex custom solutions.</p>
<p>Amazon SQS fair queues help maintain low dwell time for other tenants when there is a noisy neighbor. This happens transparently without requiring changes to your existing message processing logic. You define what constitutes a tenant in your system, and Amazon SQS handles the complex orchestration of mitigating noisy neighbor impact.</p>
<h2>How it works</h2>
<p>Amazon SQS continually monitors the distribution of messages received but not yet deleted (in-flight) by consumers across all tenants. When the system detects an imbalance:</p>
<ol> <li>It identifies the noisy tenant, the one causing the queue to build a backlog.</li> <li>It automatically adjusts message delivery order to prioritize messages belonging to quiet (non-noisy) tenants.</li> <li>It maintains overall queue throughput.</li> </ol>
<p>Consider the following example that consists of a multi-tenant queue and four different tenants (A, B, C, and D).</p>
<p>In the steady state condition, the queue has no backlog, and in-flight messages are evenly distributed among tenants. All messages are consumed immediately when they land in the queue. The dwell time of messages is low for all tenants. Notice that not all consumer capacity is fully utilized in this steady state. The steady state condition is illustrated in the following diagram.</p>
<figure><a href="https://d2908q01vomqb2.cloudfront.net/1b6453892473a467d07372d45eb05abc2031647a/2025/07/18/image-1-20.png"><img alt="Figure 1: A multi-tenant queue in steady state condition" src="https://d2908q01vomqb2.cloudfront.net/1b6453892473a467d07372d45eb05abc2031647a/2025/07/18/image-1-20.png"/></a><figcaption>Figure 1: A multi-tenant queue in steady state condition</figcaption></figure>
<p>Now consider a noisy tenant scenario in which the number of messages of tenant A increases significantly and creates a backlog in the queue. Consumers are busy processing the messages mostly from tenant A, and messages from other tenants are waiting in the backlog, leading to a higher dwell time for all tenants. This noisy tenant scenario is illustrated in the following screenshot.</p>
<figure><a href="https://d2908q01vomqb2.cloudfront.net/1b6453892473a467d07372d45eb05abc2031647a/2025/07/18/image-2-15.png"><img alt="Figure 2: A multi-tenant queue with a noisy tenant" src="https://d2908q01vomqb2.cloudfront.net/1b6453892473a467d07372d45eb05abc2031647a/2025/07/18/image-2-15.png"/></a><figcaption>Figure 2: A multi-tenant queue with a noisy tenant</figcaption></figure>
<p>When a single tenant starts to occupy a significant portion of consumer resources, Amazon SQS fair queues considers this tenant as a noisy neighbor and prioritizes returning messages belonging to other tenants. This prioritization helps maintain low dwell times for quiet tenants (B, C, D), while the dwell time for tenant A’s messages will be elevated until the queue backlog is consumed—but without impacting other tenants. Fair queues are illustrated in the following diagram.</p>
<figure><a href="https://d2908q01vomqb2.cloudfront.net/1b6453892473a467d07372d45eb05abc2031647a/2025/07/18/image-3-13.png"><img alt="Figure 3: A multi-tenant queue with fair queues" src="https://d2908q01vomqb2.cloudfront.net/1b6453892473a467d07372d45eb05abc2031647a/2025/07/18/image-3-13.png"/></a><figcaption>Figure 3: A multi-tenant queue with fair queues</figcaption></figure>
<p>Amazon SQS doesn’t limit the consumption rate per tenant. Consumers can receive messages from noisy neighbor tenants when there is consumer capacity and the queue has no other messages to return. Like Amazon SQS standard queues, fair queues allow virtually unlimited throughput, and there are no limits on the number of tenants you can have in your queue.</p>
<h2>How to use</h2>
<p>The following is a quick overview of how to get started with Amazon SQS fair queues in your applications. See the <a href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-fair-queues.html">feature documentation</a> for a detailed walkthrough. These are the high-level steps the walkthrough follows:</p>
<ol> <li>Enable Amazon SQS fair queues by adding a tenant identifier (<code>MessageGroupId</code>) to your messages</li> <li>Configure <a href="https://aws.amazon.com/cloudwatch/">Amazon CloudWatch</a> metrics to monitor Amazon SQS fair queues behavior</li> <li>You can use the example application to observe the Amazon SQS fair queues behavior with varying message volumes</li> </ol>
<h3>Enable Amazon SQS fair queues by adding a tenant identifier (MessageGroupId) to your messages</h3>
<p>Your message producers can add a tenant identifier by setting a <code>MessageGroupId</code> on an outgoing message:</p>
<pre><code>// Send message with tenant identifier
SendMessageRequest request = new SendMessageRequest()
    .withQueueUrl(queueUrl)
    .withMessageBody(messageBody)
    .withMessageGroupId("tenant-123");  // Tenant identifier
sqs.sendMessage(request);</code></pre>
<p>The new fairness capability will be applied automatically in all Amazon SQS standard queues for messages with the <code>MessageGroupId</code> property. It’s important to mention that it doesn’t require any change in the consumer code. It has no impact on API latency and doesn’t come with any throughput limitations.</p>
<h3>Configure Amazon CloudWatch metrics to monitor Amazon SQS fair queues behavior</h3>
<p>You can monitor Amazon SQS fair queues with <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/working_with_metrics.html">Amazon CloudWatch metrics</a>. The following terms are important in this context:</p>
<ul> <li><strong>Noisy groups</strong> – A noisy message group represents a noisy neighbor tenant of a multi-tenant queue.</li> <li><strong>Quiet groups</strong> – Message groups excluding noisy groups.</li> </ul>
<p>When you use fair queues, Amazon SQS now emits the following additional metrics:</p>
<ul> <li><code>ApproximateNumberOfNoisyGroups</code></li> <li><code>ApproximateNumberOfMessagesVisibleInQuietGroups</code></li> <li><code>ApproximateNumberOfMessagesNotVisibleInQuietGroups</code></li> <li><code>ApproximateNumberOfMessagesDelayedInQuietGroups</code></li> <li><code>ApproximateAgeOfOldestMessageInQuietGroups</code></li> </ul>
<p>The new <code>ApproximateNumberOfNoisyGroups</code> metric gives the number of message groups (tenants) that are considered noisy in a fair queue. This metric helps identify the number of potential noisy neighbors in multi-tenant environments by tracking message groups consuming disproportionate resources. Use this metric to set alarms that trigger when the number of noisy groups exceeds your acceptable threshold, indicating potential queue fairness issues.</p>
<p>Amazon SQS already provides several standard queue-level metrics that offer approximate insights into the queue’s state, message processing, and potential bottlenecks. These metrics look at all messages in a queue. With fair queues, there’s a new set of four equivalent metrics, shown in the preceding list, that allow the exclusion of messages from noisy neighbor groups and target only quiet groups (non-noisy tenants). Hence, they all have the <code>InQuietGroups</code> suffix.</p>
<p>To monitor the effect of Amazon SQS fair queues you can compare metrics that have the <code>InQuietGroups</code> suffix with standard queue-level metrics. During traffic surges for a specific tenant, the general queue-level metrics might reveal increasing backlogs or older message ages. However, looking at the quiet groups in isolation, you can identify that most non-noisy message groups or tenants aren’t impacted, and you can estimate the total number of impacted message groups.</p>
<p>The following graph shows how the standard queue backlog metric (<code>ApproximateNumberOfMessagesVisible</code>) increases due to a noisy tenant while the backlog for non-noisy tenants (<code>ApproximateNumberOfMessagesVisibleInQuietGroups</code>) remains low.</p>
<figure><a href="https://d2908q01vomqb2.cloudfront.net/1b6453892473a467d07372d45eb05abc2031647a/2025/07/18/image-4-12.png"><img alt="Figure 4: Queue backlog for noisy and quiet groups" src="https://d2908q01vomqb2.cloudfront.net/1b6453892473a467d07372d45eb05abc2031647a/2025/07/18/image-4-12.png"/></a><figcaption>Figure 4: Queue backlog for noisy and quiet groups</figcaption></figure>
<p>While these new metrics provide a good overview of Amazon SQS fair queues behavior, it can be beneficial to understand which specific tenant is causing the load. Use <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/ContributorInsights.html">Amazon CloudWatch Contributor Insights</a> to see metrics about the top-N contributors, the total number of unique contributors, and their usage. This is especially helpful in scenarios where you’re dealing with thousands of tenants that would otherwise lead to high-cardinality data (and cost) when emitting traditional metrics. The following screenshot shows an example of a Contributor Insights dashboard on the AWS console that visualizes the top 10 contributors based on <code>MessageGroupId</code>.</p>
<figure><a href="https://d2908q01vomqb2.cloudfront.net/1b6453892473a467d07372d45eb05abc2031647a/2025/07/18/image-5-10.png"><img alt="Figure 5: Container Insights ReceivedMessagesPerMessageGroupId dashboard" src="https://d2908q01vomqb2.cloudfront.net/1b6453892473a467d07372d45eb05abc2031647a/2025/07/18/image-5-10.png"/></a><figcaption>Figure 5: Container Insights ReceivedMessagesPerMessageGroupId dashboard</figcaption></figure>
<p>Contributor Insights creates these metrics based on data from your application log output. Let your code log the number of messages being processed, and the corresponding <code>MessageGroupId</code> within your application. You can find a full example in the sample application in the next section.</p>
<h2>Example application</h2>
<p>To make it even more straightforward to get started, we’ve prepared an example application that you can use to observe the Amazon SQS fair queues behavior with varying message volumes. You can find the source code repository, infrastructure as code (IaC), and the instructions to run the sample on the <a href="https://github.com/aws-samples/sample-amazon-sqs-fair-queues">sqs-fair-queues repository</a> on GitHub.</p>
<p>The example application includes a load generator to simulate multi-tenant traffic and provides an <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch_Dashboards.html">Amazon CloudWatch dashboard</a> that displays the most important metrics to visualize fair queue behavior. The following screenshot shows an example of the dashboard.</p>
<p>Figure 6: CloudWatch FairQueuesDashboard</p>
<h2>Conclusion</h2>
<p>Amazon SQS fair queues automatically mitigates the noisy neighbor impact in multi-tenant queues. Even when one tenant generates high message volumes or requires longer processing times (that is, becomes a noisy neighbor), the feature maintains consistent message dwell times for other tenants. When you add a tenant identifier to your messages, Amazon SQS fair queues will automatically detect and mitigate noisy neighbor impact, providing fair access to the queue for other tenants.</p>
<p>We recommend reviewing the <a href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/welcome.html">Amazon SQS Developer Guide</a> to get started and exploring the sample applications to test the behavior with varying message volumes.</p>
