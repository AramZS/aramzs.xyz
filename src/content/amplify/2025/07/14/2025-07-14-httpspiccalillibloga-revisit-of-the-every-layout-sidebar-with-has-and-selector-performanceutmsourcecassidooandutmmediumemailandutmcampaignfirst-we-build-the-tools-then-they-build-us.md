---
author: Piccalilli
cover_image: >-
  https://api.urlbox.io/v1/ln9ptArKXobLRpDQ/a6cec5ea96a99d5f6ad8595819ba29300da113ba9bc3c92573401fb149d58484/png?url=https://piccalil.li/og/a-revisit-of-the-every-layout-sidebar-with-has-and-selector-performance/&width=1024&height=526&retina=true
date: '2025-07-14T16:31:33.761Z'
dateFolder: 2025/07/14
description: >-
  Heydon Pickering takes a fresh look the Every Layout Sidebar layout, 6 years
  on, to see if modern CSS selectors can improve it.
isBasedOn: >-
  https://piccalil.li/blog/a-revisit-of-the-every-layout-sidebar-with-has-and-selector-performance/?utm_source=cassidoo&utm_medium=email&utm_campaign=first-we-build-the-tools-then-they-build-us
link: >-
  https://piccalil.li/blog/a-revisit-of-the-every-layout-sidebar-with-has-and-selector-performance/?utm_source=cassidoo&utm_medium=email&utm_campaign=first-we-build-the-tools-then-they-build-us
slug: >-
  2025-07-14-httpspiccalillibloga-revisit-of-the-every-layout-sidebar-with-has-and-selector-performanceutmsourcecassidooandutmmediumemailandutmcampaignfirst-we-build-the-tools-then-they-build-us
tags:
  - code
title: 'A revisit of the Every Layout sidebar with :has() and selector performance'
---
<p><a href="https://every-layout.dev/layouts/sidebar/">Every Layout’s <em>Sidebar</em></a> exemplifies a <em>quantum</em> CSS layout, perhaps better than any other layout we offer.</p>
<p>It is neither a two column layout, comprising elements with fixed and fluid widths, nor a single column layout comprising two vertically stacked elements. It’s both, and neither. It adapts, automatically, to context — with no <code>@media</code> or <code>@container</code> queries required.</p>
<p>The <em>Sidebar</em> is versatile too. It can set out the vertical navigation and main content of your page, and it can form intrinsically responsive media blocks, wherein the sidebar is an image.</p>
<figure><img alt="A page layout with a sidebar on the right. In the main content area, there are two media components on top of each other. Each has an image to its left." src="https://piccalilli.imgix.net/images/blog/sidebar1.svg?auto=format&amp;q=60&amp;w=1500"/><figcaption>A page layout with a sidebar on the right. In the main content area, there are two media components on top of each other. Each has an image to its left.</figcaption></figure>
<p>But, even as I’m writing about it now, the name <em>Sidebar</em> bugs me. The layout, as specified, is not actually a sidebar. A sidebar is just a (relatively) narrow element. The <em>Sidebar</em> is a layout that <em>includes</em> a sidebar. Necessarily, there are three elements in total: a container, a designated sidebar element, and an accompanying element to take up the remaining space.</p>
<p>Consequently, the code uses the term <code>with-sidebar</code> to define the container. Grammatically awkward.</p>
<p>What if this class wasn’t needed? Ideally, I’d like to place a <code>class="sidebar"</code> element anywhere on the page and the supporting meta-layout would assemble itself from the elements around it. This is now possible using the <code>:has()</code> pseudo-class:</p>
<p>Targeting the non-sidebar element is also eminently possible, using a combination of <code>:has()</code> and <code>:not()</code>. The complete code for the reusable layout would look something like this:</p>
<p>Note the custom properties with default values. You can still override these defaults (as I described in <a href="https://every-layout.dev/blog/css-components/"><em>Dynamic CSS Components Without JavaScript</em></a>) at the container level:</p>
<p>Using <code>style</code> with custom properties can get a little verbose, but it acts like a component prop, enabling <em>parametric</em> layout. By instantiating generic layouts, like <em>Sidebar</em>, with configuration, you can significantly reduce your CSS.</p>
<p>Despite doing away with some attribution, the <em>Sidebar</em> layout still requires a strict markup structure. We can test and report on incorrect structure directly in CSS, as I wrote in <em><a href="https://heydonworks.com/article/testing-html-with-modern-css/">Testing HTML With Modern CSS</a>.</em> In development, you could include a stylesheet containing the following test:</p>
<p>The error outline style, saved on the <code>:root</code> for reuse across tests, provides a visual regression.</p>
<figure><img alt="The third of three elements shows a thick red outline." src="https://piccalilli.imgix.net/images/blog/sidebar2.svg?auto=format&amp;q=60&amp;w=1500"/><figcaption>The third of three elements shows a thick red outline.</figcaption></figure>
<p>When inspecting the outlined element in dev tools, the error message is available in a custom property.</p>
<figure><img alt="View of Firefox developer tools’ inspector. The 3rd child element is matched and the error custom property reads Sidebar layouts must include exactly two child elements." src="https://piccalilli.imgix.net/images/blog/sidebar3.png?auto=format&amp;q=60&amp;w=1500"/><figcaption>View of Firefox developer tools’ inspector. The 3rd child element is matched and the error custom property reads Sidebar layouts must include exactly two child elements.</figcaption></figure>
<p>If you prefer, you can use <code>:not()</code> and turn this into a one-liner:</p>
<p>This is not to say you’d necessarily want to preclude multiple sidebars. Both of the following <em>work</em> insomuch as wrapping occurs without unintended white space appearing, but it depends what kind of layout configurations you’re happy with, at different wrapping points.</p>
<p>With two sidebars of equal size on the left, here’s how wrapping occurs with a <code>50%</code> threshold (<code>--sidebar-wrap-at</code>):</p>
<figure><img alt="Four versions of the same layout. The first is inline with two narrow sidebars on the left. The second has a row of two elements followed by a row of just one element. The third starts with one element on one row, followed by a row of two elements, with the second element slightly narrower than the first. The fourth is three elements in a column (one element per row)." src="https://piccalilli.imgix.net/images/blog/sidebar4.svg?auto=format&amp;q=60&amp;w=1500"/><figcaption>Four versions of the same layout. The first is inline with two narrow sidebars on the left. The second has a row of two elements followed by a row of just one element. The third starts with one element on one row, followed by a row of two elements, with the second element slightly narrower than the first. The fourth is three elements in a column (one element per row).</figcaption></figure>
<p>It’s the third configuration that is perhaps least desirable, since the larger (main) content has become something of a sidebar itself. It’s in this case that you might want to intervene with a <code>@container</code> query.</p>
<p>Now that <code>@container</code> queries are available, the object is not to use them <em>everywhere</em> but to apply them only where needed. Normal Flexbox wrapping behavior should still do most of the work.</p>
<p>Hypothetically, let’s say the critical point is <code>400px</code>.</p>
<p>Ideally, we’d be able to store the breakpoint value in a custom property and maintain parametric reusability. The ability to use custom properties in dimensional <code>@container</code> queries has been <a href="https://github.com/w3c/csswg-drafts/issues/8088">agreed in principle</a>, but it not yet available. In the future, you should be able to support calibration like so:</p>
<p>You can, of course, nest <em>Sidebars</em>. Primitives like <em>Sidebar</em> and its companions are designed to be composed into more complex layouts.</p>
<p>This is more likely to result in expected and predictable wrapping behavior.</p>
<figure><img alt="A layout with two sidebars to the left transforms into a single-sidebar layout followed by a full-width element below it. The third layout is a single column of three elements (one per row)." src="https://piccalilli.imgix.net/images/blog/sidebar5.svg?auto=format&amp;q=60&amp;w=1500"/><figcaption>A layout with two sidebars to the left transforms into a single-sidebar layout followed by a full-width element below it. The third layout is a single column of three elements (one per row).</figcaption></figure>
<p>Selector performance is one of those things you only need to worry about <em>very</em> infrequently, like terrestrial shark attacks. If you are repeatedly and frequently causing style recalculations, over a massively overpopulated DOM — made up of <em>thousands of nodes —</em> it is something you may want to look into, after you’ve optimised literally everything else. To put it another way: it won’t be your CSS selectors, it will probably be a JavaScript memory leak and/or a bloated DOM.</p>
<p>However, an <em>unconstrained</em> use of the <code>:has()</code> pseudo-class, as in <code>:has(&gt; .sidebar)</code>, is assigned a little turtle icon in the Firefox dev tools inspector.</p>
<p>The turtle icon, indicating slow, against the selector in Firefox dev tools</p>
<p>Given that <code>:has()</code> is the manifestation of the fabled “parent selector” — deemed a technical impossibility for years, citing anticipated performance issues — this felt like something I needed to test.</p>
<p>In Chrome’s performance profiler, I enabled CSS selector stats, and recorded myself triggering a style recalculation. I inspected the recalculation event and went to the <strong>Selector stats</strong> tab. Indeed, <code>:has(&gt; .sidebar)</code> appears as the slowest selector at… <code>0.005ms</code> in elapsed time.</p>
<p>If I’m understanding correctly, this means it would take <code>1 / 0.005</code> or 200 concurrent sidebar layouts using this selector to risk a <code>1ms</code> bottleneck on style recalculation. That or, I suppose, re-rendering the same sidebar layout every <code>0.005ms</code>, 200 times over.</p>
<p>These metrics are deceptive anyway. As Trys Mudford wrote, in <a href="https://www.trysmudford.com/blog/i-spent-a-day-making-the-website-go-2ms-faster/"><em>I wasted a day on CSS selector performance to make a website load 2ms faster</em></a>, just enabling CSS selector performance stats slows style recalculation down considerably (in their case, from <code>11.95ms</code> to <code>270ms</code> total).</p>
<p>This too is something of a quantum effect, albeit not a welcome one. In any case, don’t let the spectre of selector performance deter you from harnessing modern and powerful CSS selector patterns. There’s much more important optimizations you could be focusing on, such as reducing client-side JavaScript, keeping your DOM light, and reducing the number of render-blocking elements.</p>
<aside><p>You can support us with a one-off donation or a pay what you can afford monthly/yearly donation. Your support keeps the lights on here and reduces our need for advertising.</p></aside>
<aside data-author-summary-variant="post"><figure><figcaption><i>By</i> <a href="https://piccalil.li/author/heydon-pickering">Heydon Pickering</a></figcaption></figure><p>Heydon is a writer, creative coder, artist, and video producer. Their videos about the web are available at <a href="https://briefs.video">briefs.video</a>.</p></aside>
